<div id="header-information"><h1>Assign Keycode</h1></div>

<div id="assign-purchaser">
	<h2>Is this a new Purchaser?</h2>
	<div class="row">
		<div class="col-xs-6">
			<%= link_to 'Yes', new_purchaser_path, remote:true %>
		</div>
		<div class="col-xs-6">
			<button onclick="existing('Purchasers', 'purchaser')">NO</button>
		</div>
	</div>
</div>

<div id="purchaser-form" style="display:none;"></div>
<div id="purchaser-searchbar-list" style="display:none;"></div>
<div id="purchaser-table" class="all-tables" style="display:none;"></div>


<div id="assign-enduser" style="display:none;">
	<h2>Is this a new End User?</h2>
	<div class="row">
		<div class="col-xs-6">
			<%= link_to 'Yes', new_end_user_path, remote:true %>
		</div>
		<div class="col-xs-6">
			<button onclick="existing('End User', 'enduser')">NO</button>
		</div>
	</div>
</div>

<div id="enduser-form" style="display:none;"></div>
<div id="enduser-searchbar-list" style="display:none;"></div>
<div id="enduser-table" class="all-tables" style="display:none;"></div>

<div id="assign-key" style="display:none;">
	<h2>How would you like to assign a key?</h2>
	<div class="col-xs-4">
		<%= link_to 'Manual Key Import', new_key_path, remote:true %>
		<button>Manual Key</button>
	</div>
	<div class="col-xs-4">
		<button onclick="existing('Key Codes', 'key')">Search for keys</button>
	</div>
	<div class="col-xs-4">
		<%= link_to "Import Keys", new_key_upload_path, remote: true %>
	</div>
</div>

<div id="key-upload" style="display:none;"></div>
<div id="key-form" style="display:none;"></div>
<div id="key-searchbar-list" style="display:none;"></div>
<div id="key-table" class="all-tables" style="display:none;"></div>

<script>

	function existing(category, id){
		var category_search;
		switch(category){
			case "Purchasers":
				category_search = '<%= j ( render '/keycodes/fetch_purchasers', category: "Purchasers") %>';
				break;
			case "End User":
				category_search = '<%= j ( render '/keycodes/fetch_endusers', category: "End User") %>';
				break;
			case "Key":
				category_search = '<%= j ( render '/keycodes/fetch_keys', category: "Key Codes") %>';
				break;
		}

		$('#assign-' + id).fadeOut(200, function(){
			$("#" + id + "-searchbar-list").fadeIn(200);
			$('#' + id + '-searchbar-list').html('<h2>Find Existing ' + category + '</h2>'+ category_search);
		});
	}

	function getHighlightedRow(){
		var table_open = '<table class="table">';
		var table_head = '<thead>' + $('thead').html() + '</thead>';
		var table_body = '<tbody><tr>' + $('.bg-primary').html() + '</tr></tbody>';
		var table_close = '</table>';

		return table_open + table_head + table_body + table_close;
	}


	function selectPurchaser(){
		var selected_row = getHighlightedRow();

		$("#purchaser-table").fadeOut(200, function(){
			$("#header-information").append(selected_row);
			$("#assign-enduser").fadeIn(200);
			destroy("purchaser");
		});
	}
	function selectEndUser(){
		var selected_row = getHighlightedRow();

		$("#enduser-table").fadeOut(200, function(){
			$("#header-information").append(selected_row);
			$("#assign-key").fadeIn(200);
			destroy("enduser");
		});
	}
	function selectKey(){
		var selected_row = getHighlightedRow();

		$("#key-table").fadeOut(200, function(){
			$("#header-information").append(selected_row);
			//$("#assign-key").fadeIn(200);
			destroy("key");
		});
	}

	function destroy(elements){
		$("#" + elements + "purchaser-table").remove();
		$("#" + elements + "purchaser-form").remove();
		$("#" + elements + "-searchbar-list").remove();
		$("#assign-" + elements).remove();
	}


</script>
