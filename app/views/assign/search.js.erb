console.log("Somewhere...");
<% if @mapActive %>
    $("#assign-search-form").html("<%= j ( render "assign/forms/map_form") %>");

    console.log("map");
    // Init Map
    var map;
    var enduserPosition = { 
        lat: <%= @enduser[:lat] %>, 
        lng: <%= @enduser[:lng] %> 
    };
    map = new google.maps.Map(document.getElementById('map'), {
        center: enduserPosition,
        zoom: 8,
	    radius: <%= @yellow * 1609.34 %>
    });
    console.log("Marker");
    
    // Setup Marker
    var marker = new google.maps.Marker({ 
        position: enduserPosition, 
        map: map, 
        title: '<%= @enduser[:name] %>' ,
        animation: google.maps.Animation.DROP,
        icon: "http://maps.google.com/mapfiles/kml/paddle/blu-stars-lv.png"
    });
    var markerinfo = new google.maps.InfoWindow({ 
        content: '<%= @enduser[:address] %>' 
    });


    marker.addListener('click', function() { markerinfo.open(map, marker); } );
    marker.setIcon("http://maps.google.com/mapfiles/kml/paddle/blu-stars-lv.png");

    yellow_circle = initCircle("#FFFF00", <%= @yellow * 1609.34 %>, enduserPosition, map);
    red_circle = initCircle("#FF0000", <%= @red * 1609.34 %>, enduserPosition, map);
    
    // Setup extra end user markers
    var red_icon = "http://maps.google.com/mapfiles/ms/icons/red-dot.png";
    var yellow_icon = "http://maps.google.com/mapfiles/ms/icons/yellow-dot.png";
    var green_icon = "http://maps.google.com/mapfiles/ms/icons/green-dot.png";
    var enduser_marker;
    console.log("Markers");

    <% @endusers_red.each do |enduser| %>
        enduser_marker = addMapMarker(<%= enduser[:lat] %>, <%= enduser[:lng] %>, "<%= @enduser[:name] %>", red_icon, map);
    <% end %>
    <% @endusers_yellow.each do |enduser| %>
        enduser_marker = addMapMarker(<%= enduser[:lat] %>, <%= enduser[:lng] %>, "<%= @enduser[:name] %>", yellow_icon, map);
    <% end %>
    <% @endusers_green.each do |enduser| %>
        enduser_marker = addMapMarker(<%= enduser[:lat] %>, <%= enduser[:lng] %>, "<%= @enduser[:name] %>", green_icon, map);
<% end %>
    
    console.log("Slider");
    var mapSlider = document.getElementById('map-slider');

    noUiSlider.create(mapSlider, {
        start: [20, 80],
        connect: true,
        step: 1,
        orientation: 'horizontal', // 'horizontal' or 'vertical'
        range: {
            'min': 0,
            'max': 100
        }
        })
        
    console.log("Broken slider");

<% else %>
    $("#assign-search-form").html("<%= j (render 'assign/forms/search_form', search_type: @categorySearch, search_id: @category, search_category: @categoryName) %>")
<% end %>

console.log("Got out of the IF");

var modalElement = document.querySelector('#assign-search-form');
var instance = M.Modal.init(modalElement, 
    {
        opacity: 0.9,
        onCloseEnd: () => {
            $('#assign-search-form').off('click', '.add_fields');
            $('#assign-search-form').off('click', '.remove_fields');
            instance.destroy();
        }
    }
);

instance.open();

// Functions locted in app/assets/javascripts/application.js
$('#assign-search-form').on('click', '.remove_fields', remove_fields_click);
$('#assign-search-form').on('click', '.add_fields', add_fields_click);

$('.add_fields').click()

var selectElements = document.querySelectorAll('select');
for (var i = 0; i < selectElements.length; i++){
    M.FormSelect.init(selectElements[i]);
}
